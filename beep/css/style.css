html,
body {
    background: transparent;
    color: #333;
    margin: 0;
    padding: 0;
    overflow: hidden;
    overscroll-behavior: none;
    min-height: 100vh;
    font-family: monospace, sans-serif;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
    transition: background 0.2s ease, color 0.2s ease;
}

body,
button,
input,
select,
textarea {
    font-family: monospace, sans-serif;
}

body.playing {
    /* Background handled by Theme (Unicorn) */
    color: #fff !important;
}

body.playing #sequencer-container {
    background: transparent !important;
}

.control-btn.active#play-pause-btn {
    background: #fff;
    color: #0a0a0a;
    border-color: #fff;
}

body.playing .control-btn.active#play-pause-btn {
    background: #fff;
    color: #000;
    border-color: #fff;
}

/* Credit Button */
#credit-btn {
    position: fixed;
    top: max(12px, env(safe-area-inset-top));
    left: 12px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 1px solid rgba(0, 0, 0, 0.3);
    background: rgba(0, 0, 0, 0.1);
    color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    z-index: 100;
    transition: all 0.2s;
}

@media (hover: hover) {
    #credit-btn:hover {
        background: rgba(0, 0, 0, 0.2);
        color: rgba(0, 0, 0, 0.8);
        border-color: rgba(0, 0, 0, 0.5);
    }
}

body.playing #credit-btn {
    border-color: rgba(255, 255, 255, 0.3);
    background: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.5);
}

@media (hover: hover) {
    body.playing #credit-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.8);
        border-color: rgba(255, 255, 255, 0.5);
    }
}

@media (hover: hover) {
    #credit-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.8);
        border-color: rgba(255, 255, 255, 0.5);
    }
}

/* Credit Modal */
#credit-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #fff;
    z-index: 1001;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

#credit-modal.visible {
    display: flex;
}

#credit-content {
    background: rgba(255, 255, 255, 0.95);
    padding: 32px;
    border-radius: 0;
    text-align: center;
    width: 400px;
    max-width: calc(100vw - 40px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

#credit-content h2 {
    font-size: 24px;
    margin-bottom: 16px;
    font-weight: bold;
    color: #333;
}

#credit-logo {
    margin: 16px auto;
    cursor: pointer;
    display: block;
}

#credit-logo img {
    max-width: 100%;
    height: auto;
}

#credit-author {
    font-size: 16px;
    margin-top: 16px;
    color: #333;
}

#credit-author a {
    color: #333;
    text-decoration: none;
    font-weight: bold;
}

@media (hover: hover) {
    #credit-author a:hover {
        text-decoration: underline;
    }
}

.credit-manual-link {
    display: inline-block;
    margin-top: 24px;
    font-size: 13px;
    color: #999;
    text-decoration: none;
    border: 1px solid #ddd;
    padding: 6px 12px;
    border-radius: 4px;
    transition: all 0.2s;
}

@media (hover: hover) {
    .credit-manual-link:hover {
        background: #f5f5f5;
        color: #333;
        border-color: #bbb;
    }
}

#sequencer-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    /* Top aligned */
    justify-content: flex-start;
    align-items: center;
    gap: 12px;
    padding: 60px 20px 40px;
    position: relative;
    background: #fff;
    height: 100vh;
    overflow-y: auto;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

#sequencer-inner {
    display: flex;
    flex-direction: column;
    background: #000;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    padding: 0;
}

#sequencer-main {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    padding: 4px;
    justify-content: center;
}

/* Track Icons & Controls */
#track-icons {
    display: flex;
    flex-direction: column;
    gap: 2px;
    padding: 0;
}

.track-item {
    display: flex;
    gap: 2px;
    align-items: center;
}

.track-icon {
    width: 28px;
    height: 72px;
    border: 1px solid #333;
    background: #1a1a1a;
    color: #fff;
    cursor: pointer;
    transition: all 0.2s ease;
    box-sizing: border-box;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 16px;
    font-weight: 900;
    letter-spacing: -0.5px;
}

.track-ctrls {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.track-ctrls button {
    width: 20px;
    height: 35px;
    background: #1a1a1a;
    border: 1px solid #333;
    color: #666;
    font-size: 10px;
    font-weight: bold;
    cursor: pointer;
    padding: 0;
    transition: all 0.1s ease;
}

@media (hover: hover) {
    .track-ctrls button:hover {
        background: #333;
        color: #fff;
        border-color: #666;
    }
}

.track-ctrls button:active {
    background: #333;
    color: #fff;
    border-color: #666;
}

.track-ctrls button.active.mute-btn {
    background: #000;
    color: #fff;
    border-color: #000;
}

.track-ctrls button.active.solo-btn {
    background: #fff;
    color: #000;
    border: 1px solid #000;
}

@media (hover: hover) {
    .track-icon:hover {
        border-color: #666;
        transform: scale(1.05);
        background: #222;
    }
}

.track-icon.active {
    border-color: #fff;
    color: #fff;
    background: #333;
}

.track-icon.playing {
    animation: trackPulse 0.15s ease-out;
}

@keyframes trackPulse {
    0% {
        transform: scale(1);
        background: #333;
        color: #fff;
    }

    50% {
        transform: scale(1.1);
        background: #666;
        color: #fff;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.4);
    }

    100% {
        transform: scale(1);
        background: #333;
        color: #fff;
    }
}

.track-icon.cleared {
    animation: trackCleared 0.3s ease-out;
}

@keyframes trackCleared {
    0% {
        background: #333;
    }

    50% {
        background: #ff4444;
        opacity: 0.6;
    }

    100% {
        background: #333;
    }
}

#grid-wrapper {
    display: flex;
    flex-direction: column;
    gap: 0;
    /* Remove gap */
    position: relative;
    /* CRITICAL for absolute handles */
}

/* Grid */
#grid-container {
    display: grid;
    grid-template-columns: repeat(16, auto);
    grid-template-rows: repeat(5, 72px);
    /* Taller rows */
    gap: 2px;
    background: transparent;
    padding: 0;
}

.cell {
    width: 24px;
    height: 72px;
    cursor: pointer;
    position: relative;
    box-sizing: border-box;
    z-index: 1;
}

.cell-visual {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #1a1a1a;
    border: 1px solid #333;
    box-sizing: border-box;
    transform-origin: left center;
    transition: background 0.1s ease, border-color 0.1s ease, box-shadow 0.1s ease;
    pointer-events: none;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
}

.cell.active {
    z-index: 5;
}

.cell.adjusting {
    z-index: 200 !important;
}

.cell.adjusting .cell-visual {
    transition: none !important;
    border-color: #fff !important;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
}

.pitch-indicator {
    position: absolute;
    left: 2px;
    right: 2px;
    height: 4px;
    background: rgba(255, 255, 255, 0.9);
    pointer-events: none;
    transition: top 0.1s ease;
    border-radius: 2px;
    border: 1px solid rgba(0, 0, 0, 0.5);
}

/* Beat spacing: Add margin every 4 cells (16 steps = 4 beats) */
.cell[data-step="3"],
.cell[data-step="7"],
.cell[data-step="11"] {
    margin-right: 6px;
}

@media (hover: hover) {
    .cell:hover {
        z-index: 100 !important;
    }

    .cell:hover .cell-visual {
        border-color: #666;
    }
}

#note-indicator {
    position: fixed;
    pointer-events: none;
    background: rgba(0, 0, 0, 0.5);
    color: #fff;
    padding: 4px 8px;
    font-size: 14px;
    font-weight: bold;
    border: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: 4px;
    z-index: 3000;
    transform: translate(-50%, -120%);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    text-align: center;
}

/* Roll mode stripes */
.cell-visual.roll::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: repeating-linear-gradient(45deg,
            transparent,
            transparent 4px,
            rgba(255, 255, 255, 0.5) 4px,
            rgba(255, 255, 255, 0.5) 8px);
    pointer-events: none;
}

/* Adjust stripe density based on roll subdivision */
.cell-visual.roll[data-roll-subdivision="2"]::after {
    background: repeating-linear-gradient(45deg,
            transparent,
            transparent 6px,
            rgba(255, 255, 255, 0.5) 6px,
            rgba(255, 255, 255, 0.5) 12px);
}

.cell-visual.roll[data-roll-subdivision="4"]::after {
    background: repeating-linear-gradient(45deg,
            transparent,
            transparent 4px,
            rgba(255, 255, 255, 0.5) 4px,
            rgba(255, 255, 255, 0.5) 8px);
}

.cell-visual.roll[data-roll-subdivision="8"]::after {
    background: repeating-linear-gradient(45deg,
            transparent,
            transparent 2px,
            rgba(255, 255, 255, 0.5) 2px,
            rgba(255, 255, 255, 0.5) 4px);
}

.cell-visual.playing {
    animation: pulse 0.15s ease-out;
    z-index: 50;
}

@keyframes pulse {
    0% {
        transform: scaleX(var(--base-scale-x, 1));
    }

    50% {
        transform: scaleX(calc(var(--base-scale-x, 1) * 1.25)) scaleY(1.1);
    }

    100% {
        transform: scaleX(var(--base-scale-x, 1));
    }
}

.cell-visual.active {
    background: #666;
    border-color: rgba(255, 255, 255, 0.2);
}

.cell-visual.active.weak {
    opacity: 0.7 !important;
}

/* Playhead indicator */
.cell.playhead {
    z-index: 70;
}

.cell.playhead .cell-visual {
    border-color: #fff !important;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.4);
}

/* Tone Panel */
#tone-panel {
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    background: #1a1a1a;
    border: 2px solid #333;
    padding: 24px;
    z-index: 1000;
    transition: opacity 0.2s ease;
}

#tone-panel.hidden {
    display: none;
}

#tone-panel-content {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.knob-row {
    display: flex;
    gap: 24px;
}

.knob-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.knob {
    cursor: pointer;
    /* touch-action removed - controlled by JavaScript to allow two-finger pan */
}

.reset-btn {
    background: transparent;
    border: 1px solid #333;
    color: #666;
    padding: 6px;
    font-size: 11px;
    letter-spacing: 0.1em;
    cursor: pointer;
    transition: all 0.1s;
    margin-top: 4px;
}

@media (hover: hover) {
    .reset-btn:hover {
        border-color: #666;
        color: #fff;
        background: #222;
    }
}

.knob-label {
    font-size: 11px;
    letter-spacing: 0.1em;
    color: #999;
    text-transform: uppercase;
}

/* Controls */
#controls {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    min-height: 80px;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 24px;
    padding: 0 20px env(safe-area-inset-bottom, 0px);
    z-index: 1000;
    box-sizing: content-box;
}

.control-group {
    display: flex;
    gap: 8px;
    /* Tighter spacing for buttons */
}

.control-btn {
    width: 64px;
    height: 64px;
    background: #1a1a1a;
    border: 2px solid #333;
    border-radius: 0;
    color: #fff;
    cursor: pointer;
    transition: all 0.1s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Animation Placeholder specific */
#visualizer-display {
    cursor: default;
    position: relative;
    overflow: hidden;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    /* Match .control-btn border & shadow */
    border: 2px solid #333;
    background-color: #fff;
    background-image: none;
    background-size: 384px 48px;
    background-position: 0 0;
    background-repeat: no-repeat;
    image-rendering: pixelated;
    transition: none !important;
}

#visualizer-display.playing {
    background-image: url('../assets/jump.png?v=12');
    background-color: #fff;
    background-size: 384px 48px;
    background-position: 0 0;
    background-repeat: no-repeat;
    filter: none;
}

@media (hover: hover) {
    .control-btn:hover {
        border-color: #666;
        background: #222;
    }
}

.control-btn:active {
    transform: scale(0.95);
}

.control-btn svg {
    pointer-events: none;
}

.control-btn.active#play-pause-btn {
    background: #fff;
    color: #0a0a0a;
    border-color: #fff;
}

#swing-btn.active {
    color: #000;
    background: #fff;
    border-color: #fff;
}

/* REC button - full size, font styling */
#rec-btn {
    font-size: 13px;
    font-weight: bold;
    letter-spacing: 0.05em;
}

/* PRJ button - full size, font styling */
#file-btn {
    font-size: 13px;
    font-weight: bold;
    letter-spacing: 0.05em;
}

/* Stacked small buttons (REC + RPT) */
.control-stack {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.control-btn-sm {
    width: 64px;
    height: 30px;
    background: #1a1a1a;
    border: 2px solid #333;
    border-radius: 0;
    color: #fff;
    cursor: pointer;
    transition: all 0.1s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: bold;
    letter-spacing: 0.05em;
    padding: 0;
}

@media (hover: hover) {
    .control-btn-sm:hover {
        border-color: #666;
        background: #222;
    }
}

.control-btn-sm:active {
    transform: scale(0.95);
}

#repeat-btn.active {
    color: #000;
    background: #fff;
    border-color: #fff;
}

/* Recording button states */
#rec-btn.armed {
    color: #fff;
    background: #c00;
    border-color: #c00;
}

#rec-btn.recording {
    color: #fff;
    background: #c00;
    border-color: #c00;
    animation: recordingPulse 1s ease-in-out infinite;
}

@keyframes recordingPulse {

    0%,
    100% {
        opacity: 1;
    }

    50% {
        opacity: 0.5;
    }
}

#bpm-ctrl {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    min-width: 60px;
}

#bpm-drag-value {
    font-family: monospace;
    font-size: 13px;
    font-weight: bold;
    cursor: ns-resize;
    user-select: none;
    color: #fff;
    padding: 0;
    background: #1a1a1a;
    border: 2px solid #333;
    height: 30px;
    width: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    letter-spacing: 0.05em;
}



.bpm-picker-overlay {
    position: fixed;
    inset: 0;
    z-index: 1000;
}

.bpm-picker {
    position: fixed;
    transform: translateX(-50%);
    background: #1a1a1a;
    border: 2px solid #444;
    width: 80px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
}

.bpm-picker-list {
    height: 180px;
    overflow-y: scroll;
    scroll-snap-type: y mandatory;
    -ms-overflow-style: none;
    scrollbar-width: none;
    -webkit-mask-image: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.4) 25%, black 42%, black 58%, rgba(0,0,0,0.4) 75%, transparent 100%);
    mask-image: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.4) 25%, black 42%, black 58%, rgba(0,0,0,0.4) 75%, transparent 100%);
}

.bpm-picker-list::-webkit-scrollbar {
    display: none;
}

.bpm-picker-item {
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: monospace;
    font-size: 13px;
    font-weight: bold;
    color: #444;
    scroll-snap-align: center;
    cursor: pointer;
    user-select: none;
    transition: color 0.1s, font-size 0.1s;
}

.bpm-picker-item-selected {
    color: #fff;
    font-size: 16px;
}

.bpm-picker-highlight {
    position: absolute;
    top: 50%;
    left: 8px;
    right: 8px;
    height: 36px;
    transform: translateY(-50%);
    border-top: 1px solid #555;
    border-bottom: 1px solid #555;
    pointer-events: none;
}

#volume-ctrl {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    width: 120px;
}

.ctrl-label {
    font-size: 10px;
    color: #666;
    letter-spacing: 0.1em;
}

#volume-slider {
    width: 100%;
    height: 4px;
    background: #222;
    -webkit-appearance: none;
    appearance: none;
    outline: none;
    cursor: pointer;
}

#volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 12px;
    height: 12px;
    background: #fff;
    border-radius: 0;
}

#bpm-slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    background: #fff;
    cursor: pointer;
    border: none;
}

#bpm-display {
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    background: #000;
    border: 1px solid #fff;
    padding: 4px 12px;
    font-size: 14px;
    font-weight: bold;
    color: #fff;
    white-space: nowrap;
}


#roll-menu {
    position: fixed;
    background: #1a1a1a;
    border: 2px solid #fff;
    display: flex;
    z-index: 2000;
    pointer-events: auto;
}

#roll-menu.hidden {
    display: none;
}

.roll-option {
    padding: 8px 12px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    border-right: 1px solid #333;
    min-width: 32px;
    text-align: center;
    transition: background 0.1s ease;
}

.roll-option:last-child {
    border-right: none;
}

@media (hover: hover) {
    .roll-option:hover {
        background: #333;
    }
}

.roll-option.active {
    background: #fff;
    color: #000;
}

.hidden {
    display: none;
}

/* Mobile responsive */
@media (max-width: 768px) {
    #sequencer-container {
        flex-direction: column;
        gap: 8px;
        padding: 70px 10px 140px;
    }

    #sequencer-main {
        /* Allow horizontal scrolling for grid */
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    #track-icons {
        flex-direction: column;
        gap: 2px;
    }

    .track-item {
        flex-direction: row;
        gap: 2px;
    }

    .track-icon {
        width: 32px;
        height: 80px;
        font-size: 20px;
        font-weight: 900;
    }

    .track-ctrls {
        flex-direction: column;
        gap: 2px;
    }

    .track-ctrls button {
        width: 32px;
        height: 26px;
        font-size: 11px;
    }

    #grid-container {
        grid-template-columns: repeat(16, 24px);
        grid-template-rows: repeat(5, 80px);
        gap: 2px;
    }

    .cell {
        width: 24px;
        height: 80px;
    }

    .pitch-indicator {
        height: 3px;
    }

    /* Beat spacing for mobile */
    .cell[data-step="3"],
    .cell[data-step="7"],
    .cell[data-step="11"] {
        margin-right: 6px;
    }

    #tone-panel {
        padding: 16px;
        width: 90%;
        max-width: 300px;
    }

    .knob-row {
        gap: 16px;
    }

    .knob {
        width: 60px !important;
        height: 60px !important;
    }

    #controls {
        min-height: 120px;
        height: auto;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: auto auto;
        gap: 8px;
        padding: 12px 12px calc(12px + env(safe-area-inset-bottom, 0px));
    }

    #rec-btn {
        grid-column: 1;
        grid-row: 1;
    }

    #play-pause-btn {
        grid-column: 2;
        grid-row: 1;
    }

    #stop-btn {
        grid-column: 3;
        grid-row: 1;
    }

    .control-stack {
        grid-column: 4;
        grid-row: 1;
    }

    #bpm-ctrl {
        grid-column: 1 / 3;
        grid-row: 2;
    }

    #volume-ctrl {
        grid-column: 3 / 5;
        grid-row: 2;
    }

    #clear-btn {
        display: none;
        /* Hide on mobile to save space */
    }

    .control-btn {
        width: 100%;
        height: 48px;
        min-width: 48px;
    }
}

/* Smaller mobile */
@media (max-width: 480px) {
    #sequencer-container {
        padding: 60px 5px 140px;
    }

    h1 {
        font-size: 18px;
        margin-bottom: 12px;
    }

    .track-icon {
        width: 28px;
        height: 70px;
        font-size: 18px;
        font-weight: 900;
    }

    .track-ctrls button {
        width: 28px;
        height: 23px;
        font-size: 10px;
    }

    #grid-container {
        grid-template-columns: repeat(16, 20px);
        grid-template-rows: repeat(5, 70px);
        gap: 2px;
    }

    .cell {
        width: 20px;
        height: 70px;
    }

    .pitch-indicator {
        height: 2px;
    }

    #controls {
        min-height: 120px;
        height: auto;
        gap: 6px;
        padding: 8px 8px calc(8px + env(safe-area-inset-bottom, 0px));
    }

    .control-btn {
        height: 44px;
    }
}

/* Landscape mode optimization */
@media (max-height: 500px) and (orientation: landscape) {
    #sequencer-container {
        padding: 40px 10px 100px;
        justify-content: flex-start;
    }

    h1 {
        font-size: 18px;
        margin-bottom: 8px;
    }

    #controls {
        min-height: 80px;
        height: auto;
        gap: 6px;
        padding: 8px 8px calc(8px + env(safe-area-inset-bottom, 0px));
    }

    .control-btn {
        height: 36px;
    }

    #bpm-ctrl {
        gap: 2px;
    }

    #volume-ctrl {
        width: 100px;
    }
}

/* Portrait orientation blocker */
#rotate-prompt {
    display: none;
    position: fixed;
    inset: 0;
    background: #000;
    z-index: 9999;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 16px;
}

#rotate-prompt .rotate-icon {
    font-size: 48px;
    animation: rotateHint 2s ease-in-out infinite;
}

#rotate-prompt .rotate-text {
    font-size: 18px;
    color: #fff;
}

@keyframes rotateHint {

    0%,
    100% {
        transform: rotate(0deg);
    }

    50% {
        transform: rotate(90deg);
    }
}

@media (orientation: portrait) and (max-width: 768px) {

    /* Remove portrait blocker - portrait is now supported */
    #rotate-prompt {
        display: none !important;
    }

    /* Container */
    #sequencer-container {
        padding: 40px 4px 140px;
        gap: 4px;
        overflow-x: auto;
        overflow-y: auto;
    }

    /* Sequencer main */
    #sequencer-main {
        padding: 3px;
        gap: 3px;
    }

    /* Track icons - compact for portrait width */
    .track-icon {
        width: 20px;
        height: 50px;
        font-size: 11px;
    }

    /* Hide mute/solo buttons to save width */
    .track-ctrls {
        display: none;
    }

    /* Grid - compact cells to fit portrait width */
    #grid-container {
        grid-template-columns: repeat(16, 18px);
        grid-template-rows: repeat(5, 50px);
        gap: 1px;
    }

    .cell {
        width: 18px;
        height: 50px;
    }

    /* No beat spacing in portrait - save horizontal space */
    .cell[data-step="3"],
    .cell[data-step="7"],
    .cell[data-step="11"] {
        margin-right: 0;
    }

    .pitch-indicator {
        height: 2px;
    }

    /* Pattern bank compact */
    .pattern-pad {
        height: 22px;
        font-size: 10px;
    }

    /* Chain compact */
    .chain-slot {
        width: 24px;
        height: 24px;
        font-size: 10px;
    }

    #chain-container {
        gap: 3px;
        padding: 2px 0 0;
        min-height: 24px;
        flex-wrap: nowrap;
        justify-content: center;
    }

    #chain-toggle {
        width: auto;
        height: 24px;
        padding: 0 4px;
        font-size: 8px;
        margin-right: 2px;
    }

    #chain-container .chain-arrow {
        display: none;
    }

    /* Controls - 2 row grid layout */
    #controls {
        height: auto;
        display: grid;
        grid-template-columns: auto auto auto auto;
        grid-template-rows: auto auto;
        gap: 4px 6px;
        padding: 6px 8px calc(6px + env(safe-area-inset-bottom, 0px));
        justify-content: center;
        align-items: center;
    }

    /* Flatten control-group so children participate in grid */
    .control-group {
        display: contents;
    }

    /* Row 1: transport controls */
    #rec-btn {
        grid-row: 1;
        grid-column: 1;
    }

    #play-pause-btn {
        grid-row: 1;
        grid-column: 2;
    }

    #stop-btn {
        grid-row: 1;
        grid-column: 3;
    }

    .control-stack {
        grid-row: 1;
        grid-column: 4;
    }

    /* Row 2: BPM, Volume, File */
    #bpm-ctrl {
        grid-row: 2;
        grid-column: 1;
        min-width: auto;
    }

    #volume-ctrl {
        grid-row: 2;
        grid-column: 2 / 4;
        width: auto;
    }

    #file-btn {
        grid-row: 2;
        grid-column: 4;
        width: 36px;
        height: 36px;
    }

    /* Hide non-essential controls on portrait */
    #visualizer-display {
        display: none;
    }

    #clear-btn {
        display: none;
    }

    #scale-ctrl {
        display: none !important;
    }

    /* Control button sizes */
    .control-btn {
        width: 44px;
        height: 44px;
        min-width: 44px;
    }

    .control-btn-sm {
        width: 44px;
        height: 20px;
        font-size: 9px;
    }

    #bpm-drag-value {
        font-size: 14px;
    }

    /* Credit button */
    #credit-btn {
        width: 28px;
        height: 28px;
        font-size: 14px;
    }

    /* Tone panel */
    #tone-panel {
        padding: 12px;
        width: 90%;
        max-width: 300px;
    }

    .knob-row {
        gap: 12px;
    }

    .knob {
        width: 50px !important;
        height: 50px !important;
    }

}

/* Landscape mobile - primary mobile experience */
@media (max-width: 932px) and (orientation: landscape) {

    /* Cell size - wider for better touch targets */
    .cell {
        width: 28px;
        height: 42px;
    }

    #grid-container {
        grid-template-columns: repeat(16, auto);
        grid-template-rows: repeat(5, 42px);
    }

    /* Beat spacing */
    .cell[data-step="3"],
    .cell[data-step="7"],
    .cell[data-step="11"] {
        margin-right: 6px;
    }

    /* Track icons */
    .track-icon {
        width: 28px;
        height: 42px;
        font-size: 14px;
    }

    .track-ctrls button {
        width: 28px;
        /* Match track icon width */
        height: 20px;
        font-size: 9px;
    }

    /* Control bar horizontal layout */
    #controls {
        min-height: 60px;
        height: auto;
        gap: 12px;
        padding: 0 12px env(safe-area-inset-bottom, 0px);
        display: flex;
        flex-direction: row;
    }

    .control-group {
        gap: 6px;
    }

    .control-btn {
        width: 48px;
        height: 48px;
    }

    .control-btn-sm {
        width: 48px;
        height: 23px;
        font-size: 10px;
    }

    #visualizer-display {
        width: 36px;
        height: 36px;
        background-size: 288px 36px;
        /* 8 frames × 36px */
        transition: none !important;
        /* No sliding animation */
    }

    #volume-ctrl {
        width: 80px;
    }

    #bpm-ctrl {
        min-width: 50px;
    }

    #bpm-drag-value {
        font-size: 16px;
    }

    /* Container adjustment */
    #sequencer-container {
        padding: 32px 8px 70px;
    }

    /* Sequencer main - reduce padding */
    #sequencer-main {
        padding: 4px;
        gap: 6px;
        width: fit-content;
    }

    /* Tone panel */
    #tone-panel {
        padding: 12px;
    }

    .knob-row {
        gap: 12px;
    }

    .knob {
        width: 50px !important;
        height: 50px !important;
    }

    /* Credit modal - compact for mobile */
    #credit-content {
        width: 280px;
        max-width: calc(100vw - 40px);
        max-height: calc(100vh - 40px);
        padding: 20px;
        overflow-y: auto;
    }

    #credit-content h2 {
        font-size: 18px;
        margin-bottom: 12px;
    }

    #credit-logo {
        margin: 12px auto;
    }

    #credit-logo img {
        max-width: 180px;
        max-height: 120px;
    }

    #credit-author {
        font-size: 14px;
        margin-top: 12px;
    }

}

/* Very small landscape (iPhone SE etc) */
@media (max-width: 700px) and (orientation: landscape) {
    .cell {
        width: 24px;
        height: 36px;
    }

    #grid-container {
        grid-template-columns: repeat(16, auto);
        grid-template-rows: repeat(5, 36px);
    }

    .track-icon {
        width: 22px;
        height: 36px;
        font-size: 12px;
    }

    .track-ctrls button {
        width: 22px;
        /* Match track icon width */
        height: 17px;
        font-size: 8px;
    }

    #controls {
        min-height: 52px;
        height: auto;
        gap: 8px;
    }

    .control-btn {
        width: 40px;
        height: 40px;
    }

    .control-btn-sm {
        width: 40px;
        height: 19px;
        font-size: 9px;
    }

    #visualizer-display {
        width: 32px;
        height: 32px;
        background-size: 256px 32px;
        /* 8 frames × 32px */
        transition: none !important;
        /* No sliding animation */
    }

    #volume-ctrl {
        width: 60px;
    }

    .knob {
        width: 40px !important;
        height: 40px !important;
    }

    /* DJ overlay - match controls height */
    #dj-overlay {
        bottom: 68px;
    }

    .dj-fx-btn {
        width: 40px;
        height: 40px;
        font-size: 9px;
    }

    #dj-auto-rec,
    #dj-clr-btn {
        width: 40px;
        height: 40px;
        font-size: 9px;
    }

    #dj-ribbon {
        height: 40px;
    }

    #dj-fx-buttons {
        gap: 4px;
        padding: 4px 6px;
    }

    .ribbon-marks span {
        font-size: 10px;
    }

    /* Credit modal - extra compact for small screens */
    #credit-content {
        width: 240px;
        max-width: calc(100vw - 30px);
        max-height: calc(100vh - 30px);
        padding: 16px;
    }

    #credit-content h2 {
        font-size: 16px;
        margin-bottom: 10px;
    }

    #credit-logo {
        margin: 10px auto;
    }

    #credit-logo img {
        max-width: 150px;
        max-height: 100px;
    }

    #credit-author {
        font-size: 12px;
        margin-top: 10px;
    }

    /* Sequencer main - reduce padding */
    #sequencer-main {
        padding: 4px;
        gap: 5px;
        width: fit-content;
    }

    /* DJ Mode for Mobile - Hide in portrait/small screens to avoid overlap */
    #dj-overlay {
        display: none !important;
    }
}

/* DJ Mode Overlay */
#dj-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: calc(80px + env(safe-area-inset-bottom, 0px));
    background: rgba(0, 0, 0, 0.5);
    z-index: 900;
    display: flex;
    flex-direction: column-reverse;
}

#dj-overlay.hidden {
    display: none;
}

/* DJ overlay bottom adjustments per breakpoint (must come after default rule) */
/* Portrait ≤768px: controls become 2-row grid (~100px tall) */
@media (orientation: portrait) and (max-width: 768px) {
    #dj-overlay {
        bottom: calc(100px + env(safe-area-inset-bottom, 0px));
    }
}

/* Landscape ≤932px: controls min-height 60px */
@media (max-width: 932px) and (orientation: landscape) {
    #dj-overlay {
        bottom: calc(60px + env(safe-area-inset-bottom, 0px));
    }
}

/* Landscape ≤700px: DJ overlay hidden */
@media (max-width: 700px) and (orientation: landscape) {
    #dj-overlay {
        display: none !important;
    }
}

/* DJ Effect Buttons + Ribbon (single row) */
#dj-fx-buttons {
    display: flex;
    gap: 6px;
    padding: 6px 8px;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

/* Ribbon Controller (inline within FX row) */
#dj-ribbon-container {
    flex: 0.5;
    min-width: 0;
}

#dj-ribbon {
    position: relative;
    height: 48px;
    background: rgba(0, 0, 0, 0.8);
    border: 1px solid #444;
    border-radius: 4px;
    cursor: crosshair;
    touch-action: none;
    overflow: hidden;
    user-select: none;
    -webkit-user-select: none;
}

#dj-ribbon-cursor {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 20%;
    /* 5 steps (-2..+2), so 20% width per step */
    left: 40%;
    /* Start at 0 (center) */
    background: rgba(255, 255, 255, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.6);
    pointer-events: none;
}

.ribbon-marks {
    display: flex;
    height: 100%;
    align-items: center;
    justify-content: space-around;
    pointer-events: none;
}

.ribbon-marks span {
    font-family: monospace;
    font-size: 12px;
    color: #888;
    z-index: 1;
}

.dj-fx-btn {
    flex: none;
    width: 48px;
    height: 48px;
    background: rgba(0, 0, 0, 0.8);
    border: 1px solid #444;
    color: #666;
    font-family: monospace;
    font-size: 11px;
    font-weight: bold;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: all 0.08s ease;
    touch-action: none;
    user-select: none;
    -webkit-user-select: none;
}

@media (hover: hover) {
    .dj-fx-btn:hover {
        border-color: #888;
        color: #aaa;
    }
}

.dj-fx-btn:active {
    background: #333;
    border-color: #666;
    color: #fff;
}

.dj-fx-btn.active {
    background: #fff;
    color: #000;
    border-color: #fff;
}

/* Automated state (outline only) */
.dj-fx-btn.automated {
    border-color: #fff;
    color: #fff;
    box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.2);
}

/* CIRCULAR SPECIAL BUTTONS (AUTO, CLR) */
#dj-auto-rec,
#dj-clr-btn {
    flex: none;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    font-size: 10px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.8);
    border: 1px solid #444;
    color: #666;
    font-family: monospace;
    font-weight: bold;
    letter-spacing: 0.1em;
    cursor: pointer;
    transition: all 0.08s ease;
    touch-action: none;
    user-select: none;
    -webkit-user-select: none;
}

#dj-auto-rec {
    margin-left: 4px;
}

#dj-clr-btn {
    margin-left: 0;
}

#dj-auto-rec.active {
    background: #f00 !important;
    color: #fff !important;
    border-color: #f00 !important;
    box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
}

#dj-auto-rec.playing {
    background: rgba(255, 255, 255, 0.8);
    color: #000;
    border-color: #fff;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
}

#dj-clr-btn:active {
    background: #333;
    border-color: #666;
    color: #fff;
}

/* DJ XY Pad */
#dj-xy-pad {
    flex: 1;
    position: relative;
    cursor: crosshair;
    touch-action: none;
    overflow: hidden;
}

#dj-xy-label {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: monospace;
    font-size: 14px;
    letter-spacing: 0.3em;
    color: #333;
    pointer-events: none;
    z-index: 1;
}

#dj-params {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    gap: 48px;
    pointer-events: none;
}

.dj-param {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.dj-param-label {
    font-size: 12px;
    color: #666;
    letter-spacing: 0.2em;
}

.dj-param-value {
    font-size: 32px;
    font-weight: bold;
    color: #fff;
    font-family: monospace;
}

/* DJ Ripple Canvas */
#dj-ripple-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

/* DJ Visuals */
#dj-visuals {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.dj-marker {
    position: absolute;
    width: 40px;
    height: 40px;
    border: 3px solid #fff;
    border-radius: 50%;
    top: 0;
    left: 0;
    /* Centering handled by transform in JS */
    will-change: transform;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

.dj-marker.hidden,
#dj-line.hidden {
    opacity: 0;
}

#dj-origin {
    opacity: 0.5;
    border-style: dashed;
}

#dj-current {
    background: rgba(255, 255, 255, 0.2);
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
}

#dj-line {
    position: absolute;
    height: 4px;
    background: linear-gradient(90deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.8));
    transform-origin: 0 50%;
    top: 0;
    left: 0;
    border-radius: 2px;
    will-change: transform;
}

/* Make visualizer clickable during playback */
#visualizer-display.playing {
    cursor: pointer;
}

/* Basic Visualizer Style (duplicate - kept for layout props) */
#visualizer-display {
    position: relative;
    z-index: 10;
    width: 48px;
    height: 48px;
    aspect-ratio: 1 / 1;
    flex-shrink: 0;
    border-radius: 50%;
    margin: 0 10px;
    background-color: #fff;
    background-image: none;
    background-repeat: no-repeat;
    overflow: hidden;
    cursor: default;
    /* Match .control-btn border */
    border: 2px solid #333;
    box-shadow: none;
    transition: border-width 0.1s;
}

/* Sprite Animation Keyframes */
@keyframes play-sprite {
    0% {
        background-position: 0 0;
    }

    100% {
        background-position: -384px 0;
    }

    /* 48px * 8 frames */
}

/* Playing state: Show dancer with sprite animation */
/* DUPLICATE RULE REMOVED - See line 624 */
/* #visualizer-display.playing {
    background: url('../assets/danceA.png') no-repeat 0 0;
    background-size: 384px 48px;
    filter: invert(1);
    border-color: #000;
    animation: play-sprite 0.8s steps(8) infinite;
    cursor: pointer;
} */

/* Paused: freeze animation in place */
#visualizer-display.paused {
    animation-play-state: paused;
}

/* Standby (Momentary): 2px border */
#visualizer-display.standby {
    border-width: 2px !important;
    animation: none;
}

/* DJ Keep Mode: thick border */
#visualizer-display.dj-keep {
    border: 4px solid #b39ddb;
    animation: none;
}

/* Beat Pulse: Scale effect only */
#visualizer-display.pulse {
    transform: scale(1.02);
    transition: transform 0.05s ease-out;
}

/* ======================== */
/* Pattern Bank (tabs)      */
/* ======================== */

#pattern-bank {
    display: flex;
    gap: 0;
    padding: 4px 4px 0;
}

.pattern-pad {
    flex: 1;
    height: 28px;
    background: #111;
    border: none;
    border-bottom: 2px solid #333;
    color: #555;
    font-family: monospace;
    font-size: 13px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.1s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
}

@media (hover: hover) {
    .pattern-pad:hover {
        background: #1a1a1a;
        color: #aaa;
    }
}

.pattern-pad.has-data {
    color: #888;
}

.pattern-pad.active {
    background: #000;
    color: #fff;
    font-weight: 900;
    border-bottom: 2px solid #fff;
}

.pattern-pad.queued {
    color: #fff;
    animation: patternBlink 0.4s ease-in-out infinite alternate;
}

@keyframes patternBlink {
    0% {
        opacity: 0.4;
    }

    100% {
        opacity: 1;
    }
}

body.playing .pattern-pad.has-data {
    color: #999;
}

/* Context Menu (shared) */
.context-menu {
    position: fixed;
    background: #1a1a1a;
    border: 2px solid #fff;
    display: flex;
    z-index: 2000;
    pointer-events: auto;
}

/* DJ Auto Menu: ensure it appears above dj-overlay (z-index: 900) */
#auto-menu {
    z-index: 9000;
}

.context-menu.hidden {
    display: none;
}

.context-menu .menu-item {
    padding: 8px 14px;
    color: #fff;
    cursor: pointer;
    font-size: 12px;
    font-weight: bold;
    letter-spacing: 0.05em;
    border-right: 1px solid #333;
    transition: background 0.1s ease;
}

.context-menu .menu-item:last-child {
    border-right: none;
}

@media (hover: hover) {
    .context-menu .menu-item:hover {
        background: #333;
    }
}

.context-menu .menu-item.disabled {
    color: #444;
    pointer-events: none;
}

/* ======================== */
/* Pattern Chain            */
/* ======================== */

#chain-container {
    display: flex;
    gap: 4px;
    justify-content: center;
    padding: 8px 0 0;
    min-height: 36px;
}

.chain-slot {
    width: 36px;
    height: 36px;
    background: transparent;
    border: 1px dashed #333;
    color: #444;
    font-family: monospace;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.1s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
}

@media (hover: hover) {
    .chain-slot:hover {
        border-color: #666;
        color: #888;
    }
}

.chain-slot.filled {
    border-style: solid;
    border-color: #555;
    color: #ccc;
    background: #1a1a1a;
}

.chain-slot.playing {
    border-color: #fff;
    color: #fff;
    background: #333;
}

body.playing .chain-slot {
    border-color: #444;
}

body.playing .chain-slot.filled {
    border-color: #666;
}

body.playing .chain-slot.playing {
    border-color: #fff;
    background: #444;
}

/* Chain toggle switch (vertical stack) */
#chain-mode-switch {
    display: flex;
    flex-direction: column;
    background: #1a1a1a;
    border: 1px solid #333;
    border-radius: 0;
    overflow: hidden;
    margin-right: 6px;
    height: 36px;
    cursor: pointer;
}

.mode-option {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 6px;
    font-size: 9px;
    font-weight: bold;
    color: #666;
    transition: all 0.2s;
    background: #1a1a1a;
    line-height: normal;
}

.mode-option:first-child {
    border-bottom: 1px solid #333;
}

@media (hover: hover) {
    .mode-option:hover {
        color: #999;
        background: #222;
    }
}

.mode-option.active {
    background: #fff;
    color: #000;
}

/* Container modifications */
.mode-chain #chain-container {
    border-color: #666;
}

.mode-live #chain-container {
    border-color: #333;
}

/* LIVE mode: slots become pattern selectors */
.chain-slot.live-active {
    border: 1px solid #fff;
    color: #fff;
    background: #444;
}

.chain-slot.queued {
    animation: slot-blink 0.4s ease-in-out infinite alternate;
}

@keyframes slot-blink {
    0% {
        opacity: 0.4;
    }

    100% {
        opacity: 1;
    }
}

#chain-container.mode-live .chain-slot {
    border: 1px solid #444;
    color: #888;
}

@media (hover: hover) {
    #chain-container.mode-live .chain-slot:hover {
        border-color: #888;
        color: #fff;
    }
}

/* Chain disabled: gray out slots (unused now but kept for safety) */
#chain-container.chain-disabled .chain-slot {
    opacity: 0.3;
    pointer-events: none;
}

#chain-container.chain-disabled .chain-arrow {
    opacity: 0.3;
}

/* Chain arrow indicators */
.chain-arrow {
    display: flex;
    align-items: center;
    color: #333;
    font-size: 10px;
    user-select: none;
}

body.playing .chain-arrow {
    color: #555;
}

/* Landscape mobile pattern bank + chain */
@media (max-width: 932px) and (orientation: landscape) {
    .pattern-pad {
        height: 24px;
        font-size: 11px;
    }

    .chain-slot {
        width: 28px;
        height: 28px;
        font-size: 11px;
    }

    #chain-mode-switch {
        margin-right: 4px;
        height: 28px;
    }

    .mode-option {
        font-size: 8px;
        padding: 0 4px;
    }

    .chain-arrow {
        font-size: 8px;
    }

    #chain-container {
        gap: 2px;
        padding: 4px 0 0;
    }
}

/* Very small landscape */
@media (max-width: 700px) and (orientation: landscape) {
    .pattern-pad {
        height: 22px;
        font-size: 10px;
    }

    .chain-slot {
        width: 24px;
        height: 24px;
        font-size: 10px;
    }

    .mode-option {
        font-size: 7px;
        padding: 0 3px;
    }

    #chain-mode-switch {
        margin-right: 2px;
        height: 24px;
    }
}

.dj-fx-btn.disabled {
    opacity: 0.3;
    pointer-events: none;
    filter: grayscale(1);
    border-color: #222;
}

/* Large Screen Landscape Optimization (padd/PC) */
@media (min-width: 960px) {
    .cell {
        width: 48px;
        height: 84px;
        /* Taller rows */
    }

    .track-icon {
        width: 48px;
        height: 84px;
        /* Match cell height */
    }

    #grid-container {
        grid-template-rows: repeat(5, 84px);
        /* Match cell height */
    }

    /* Mute/Solo Buttons: Wider and Taller */
    .track-ctrls button {
        width: 40px;
        height: 41px;
        /* (84px - 2px gap) / 2 */
        font-size: 11px;
        /* Slightly larger text */
    }

    /* Adjust chain slot size too? */
    .chain-slot {
        width: 48px;
        height: 48px;
        font-size: 16px;
    }

    #chain-mode-switch {
        height: 48px;
    }

    /* Adjust beat spacing margin */
    .cell[data-step="3"],
    .cell[data-step="7"],
    .cell[data-step="11"] {
        margin-right: 12px;
        /* Double margin */
    }

    /* Ensure container allows width */
    #sequencer-container {
        max-width: none;
        width: 100%;
    }
}

/* =====================================================================
   UNICORN THEME
   ===================================================================== */

:root {
    --unicorn-bg: #e0f7fa;
    --unicorn-border: #b39ddb;
    --unicorn-text: #5e35b1;
    --unicorn-btn-bg: #ffffff;
    --unicorn-btn-hover: #f3e5f5;
    --unicorn-active: #ff80ab;
    --unicorn-shadow: rgba(149, 117, 205, 0.2);
    --pastel-pink: #f8bbd0;
    --pastel-blue: #b3e5fc;
    --pastel-green: #b9f6ca;
    --pastel-yellow: #fff9c4;
    --pastel-purple: #d1c4e9;
}

/* Background & Body */
body,
button,
input,
select,
textarea {
    background: transparent;
    color: var(--unicorn-text);
    font-family: monospace, sans-serif;
    margin: 0;
}

body {
    min-height: 100vh;
}

/* Stop Gradient */
body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #e1bee7 0%, #b3e5fc 100%);
    z-index: -2;
    pointer-events: none;
}

/* Play Gradient */
body::after {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #f8bbd0 0%, #d1c4e9 100%);
    z-index: -1;
    opacity: 0;
    transition: opacity 1.5s ease-in-out;
    pointer-events: none;
}

body.playing::after {
    opacity: 1;
}

#sequencer-container {
    background: transparent !important;
    position: relative;
    z-index: 1;
}

/* Main Sequencer Box */
#sequencer-inner {
    background: rgba(255, 255, 255, 0.4);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
    backdrop-filter: blur(4px);
    border-radius: 20px;
    border: 3px solid rgba(255, 255, 255, 0.6);
    padding: 10px;
}

/* Pattern Bank */
#pattern-bank {
    display: flex;
    background: #fff;
    border: 2px solid var(--unicorn-border);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 8px;
    height: 34px;
    gap: 0;
    padding: 0;
    width: 100%;
}

.pattern-pad {
    flex: 1;
    background: #fff;
    border-right: 1px solid var(--unicorn-border);
    color: var(--unicorn-border);
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    height: 100%;
    margin: 0;
    border-radius: 0;
    cursor: pointer;
    transition: all 0.2s;
}

.pattern-pad:last-child {
    border-right: none;
}

.pattern-pad.active {
    background: var(--unicorn-active);
    color: #fff;
}

.pattern-pad.queued {
    animation: blink-pink 0.4s ease-in-out infinite alternate;
}

@media (hover: hover) {
    .pattern-pad:hover {
        background: #fdf5e6;
    }
}

/* Grid & Cells */
#grid-container {
    display: grid;
    row-gap: 4px;
    column-gap: 2px;
    grid-template-rows: repeat(5, auto);
    grid-template-columns: repeat(16, auto);
    width: fit-content;
    margin: 0 auto;
}

.cell {
    width: 28px;
    height: 72px;
    filter: none;
    box-sizing: border-box;
}

.cell-visual {
    background: rgba(255, 255, 255, 0.6);
    border: 2px solid #e1bee7;
    border-radius: 12px;
    overflow: visible;
}

.pitch-indicator {
    z-index: 2;
}

@media (min-width: 960px) {
    .cell {
        width: 48px;
        height: 84px;
    }

    #grid-container {
        row-gap: 6px;
    }
}

.cell[data-step="3"],
.cell[data-step="7"],
.cell[data-step="11"] {
    margin-right: 12px;
}

@media (hover: hover) {
    .cell:hover {
        transform: scale(0.95);
    }

    .cell:hover .cell-visual {
        border-color: var(--unicorn-active);
    }
}

/* Grid ON State */
.cell-visual.active {
    background-color: var(--unicorn-active);
    border: 2px solid #fff;
    box-shadow: 0 0 10px var(--unicorn-active);
}

/* Track Icons */
.track-icon {
    background: rgba(255, 255, 255, 0.8) !important;
    border: 2px solid var(--unicorn-border) !important;
    border-radius: 12px !important;
    color: var(--unicorn-text) !important;
    box-shadow: 4px 4px 0 var(--unicorn-shadow) !important;
    font-weight: bold !important;
}

.track-icon.active {
    background: var(--unicorn-text) !important;
    color: #fff !important;
    border-color: #fff !important;
}

/* Chain / Live Toggle */
#chain-mode-switch {
    /* Single capsule: border lives on the container, not individual buttons */
    border: 2px solid var(--unicorn-border);
    border-radius: 99px;
    background: #fff;
    box-shadow: 0 1px 4px var(--unicorn-shadow);
    overflow: visible;
    gap: 0;
    height: 40px;
    width: 40px;
    padding: 0;
    margin: 0 4px;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    justify-content: center;
}

.mode-option {
    flex: 1;
    width: 100%;
    padding: 0;
    font-size: 8px;
    border-radius: 0;
    font-weight: bold;
    color: var(--unicorn-text);
    background: transparent;
    border: none;
    box-shadow: none;
    cursor: pointer;
    transition: background 0.1s, color 0.1s;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
}

.mode-option:active {
    opacity: 0.8;
}

/* Each button owns its outer corners to avoid relying on overflow:hidden clipping */
.mode-option:first-child {
    border-radius: 99px 99px 0 0;
    border-bottom: 1px solid var(--unicorn-border);
}

.mode-option:last-child {
    border-radius: 0 0 99px 99px;
}

.mode-option.active {
    background: var(--unicorn-active);
    color: #fff;
}

/* Chain Slots */
.chain-slot {
    width: 40px;
    height: 40px;
    min-width: 40px;
    min-height: 40px;
    border-radius: 50%;
    border: 2px solid var(--unicorn-border);
    background: #fff;
    color: var(--unicorn-text);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: bold;
    box-shadow: 3px 3px 0 var(--unicorn-shadow);
    margin: 0 4px;
    padding: 0;
    box-sizing: border-box;
}

.chain-slot.active,
.chain-slot.playing,
.chain-slot.live-active {
    background: var(--unicorn-active) !important;
    color: #fff !important;
    border-color: #fff !important;
    transform: translateY(2px);
    box-shadow: 0 0 10px var(--unicorn-active) !important;
}

.chain-slot.queued {
    animation: blink-pink 0.4s ease-in-out infinite alternate;
}

/* Override: main CSS .chain-slot.filled { background: #1a1a1a } has higher specificity */
.chain-slot.filled {
    background: rgba(255, 255, 255, 0.8);
    border-style: solid;
    border-color: var(--unicorn-border);
    color: var(--unicorn-text);
}

/* Override: main CSS #chain-container.mode-live .chain-slot { border: 1px solid #444 } */
#chain-container.mode-live .chain-slot {
    border-color: var(--unicorn-border);
    color: var(--unicorn-text);
}

/* BPM */
#bpm-drag-value {
    background: #fff;
    color: var(--unicorn-text);
    border: 2px solid var(--unicorn-border);
    border-radius: 12px;
}

.bpm-picker {
    background: #fff;
    border: 2px solid var(--unicorn-border);
    border-radius: 16px;
    box-shadow: 4px 4px 0 var(--unicorn-shadow);
}

.bpm-picker-item {
    color: rgba(94, 53, 177, 0.25);
}

.bpm-picker-item-selected {
    color: var(--unicorn-text);
}

.bpm-picker-highlight {
    border-color: var(--unicorn-border);
}

/* Scale Select */
#scale-select {
    background: #ffffff;
    border: 2px solid var(--unicorn-border);
    border-radius: 20px;
    color: #5e35b1;
    padding: 4px 28px 4px 10px;
    font-family: inherit;
    font-weight: bold;
    box-shadow: 3px 3px 0 var(--unicorn-shadow);
    cursor: pointer;
    -webkit-appearance: none;
    appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%235e35b1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 8px center;
    background-size: 14px;
}

#scale-select option {
    background: #ffffff;
    color: #5e35b1;
}

.ctrl-label {
    color: var(--unicorn-text);
    font-weight: bold;
    opacity: 0.8;
}

/* Override: main CSS #volume-slider { background: #222 } not overridden globally */
#volume-slider {
    background: var(--unicorn-border);
}

/* Tone Panel */
#tone-panel {
    background: rgba(255, 255, 255, 0.95);
    border: 3px solid var(--unicorn-border);
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(100, 50, 200, 0.2);
}

.knob-container .knob-label {
    color: var(--unicorn-text);
    font-weight: 800;
}

/* Global Controls */
.control-btn,
.control-btn-sm {
    background: var(--unicorn-btn-bg);
    border: 2px solid var(--unicorn-border);
    border-radius: 50px;
    color: var(--unicorn-text);
    box-shadow: 4px 4px 0 var(--unicorn-shadow);
}

.control-btn.active,
.control-btn-sm.active {
    background: var(--unicorn-active);
    color: #fff;
    border-color: #fff;
}

/* Override: main CSS uses ID selector (#play-pause-btn) giving higher specificity */
.control-btn.active#play-pause-btn,
body.playing .control-btn.active#play-pause-btn {
    background: var(--unicorn-active) !important;
    color: #fff !important;
    border-color: #fff !important;
}

/* Override: main CSS #repeat-btn.active { color: #000 } beats .control-btn-sm.active */
#repeat-btn.active {
    background: var(--unicorn-active) !important;
    color: #fff !important;
    border-color: #fff !important;
}

#swing-btn.active {
    background: var(--pastel-pink);
    color: var(--unicorn-text);
    border-color: var(--unicorn-border);
}

#swing-btn.active.heavy {
    background: var(--unicorn-active);
    color: #fff;
    border-color: #fff;
    box-shadow: 0 0 10px var(--unicorn-active);
}

#rec-btn.armed {
    animation: blink-pink 0.6s ease-in-out infinite alternate;
    background: var(--pastel-pink);
    color: #fff;
    border-color: #fff;
}

#rec-btn.recording {
    background: var(--unicorn-active);
    color: #fff;
    border-color: #fff;
    box-shadow: 0 0 15px var(--unicorn-active);
}

@keyframes blink-pink {
    0% {
        background: #fff;
        color: var(--unicorn-active);
        box-shadow: 4px 4px 0 var(--unicorn-shadow);
    }

    100% {
        background: var(--unicorn-active);
        color: #fff;
        box-shadow: 0 0 10px var(--unicorn-active);
    }
}

/* Control Panel */
#controls {
    background: var(--pastel-green);
    border-top: 2px solid var(--unicorn-border);
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
}

/* Visualizer */
#visualizer-display {
    background-color: var(--unicorn-btn-bg);
    border: 2px solid var(--unicorn-border);
    box-shadow: 4px 4px 0 var(--unicorn-shadow);
}

#visualizer-display.dj-keep {
    border: 4px solid var(--unicorn-active) !important;
    box-shadow: 0 0 10px var(--unicorn-active) !important;
}

/* DJ Mode */
#dj-overlay {
    background: rgba(224, 247, 250, 0.4);
    backdrop-filter: blur(4px);
    border-top: 3px solid var(--unicorn-border);
}

#dj-fx-buttons {
    background: rgba(255, 255, 255, 0.6);
    border-bottom: 2px solid var(--unicorn-border);
}

.dj-fx-btn {
    background: #fff;
    border: 2px solid var(--unicorn-border);
    border-radius: 12px;
    color: var(--unicorn-text);
    box-shadow: 2px 2px 0 var(--unicorn-shadow);
    font-family: inherit;
}

.dj-fx-btn.active {
    background: var(--unicorn-active);
    color: #fff;
    border-color: #fff;
    box-shadow: 0 0 10px var(--unicorn-active);
}

.dj-fx-btn.automated {
    border-color: var(--unicorn-active);
    color: var(--unicorn-active);
    background: #fff;
    box-shadow: inset 0 0 8px var(--pastel-pink);
}

#dj-ribbon {
    background: #fff;
    border: 2px solid var(--unicorn-border);
    border-radius: 12px;
}

#dj-ribbon-cursor {
    background: var(--pastel-purple);
    border: 2px solid #fff;
    border-radius: 6px;
    opacity: 0.8;
}

.ribbon-marks span {
    color: var(--unicorn-text);
    font-weight: bold;
    opacity: 0.6;
}

#dj-auto-rec,
#dj-clr-btn {
    background: #fff;
    border: 2px solid var(--unicorn-border);
    color: var(--unicorn-text);
    box-shadow: 3px 3px 0 var(--unicorn-shadow);
}

#dj-auto-rec.active {
    background: var(--unicorn-active) !important;
    color: #fff !important;
    border-color: #fff !important;
    animation: blink-pink 0.6s ease-in-out infinite alternate !important;
}

#dj-auto-rec.playing {
    background: var(--pastel-blue);
    color: var(--unicorn-text);
    border-color: var(--unicorn-text);
}

#dj-xy-label {
    color: var(--unicorn-text);
    font-weight: bold;
    opacity: 0.3;
    letter-spacing: 0.5em;
}

.dj-marker {
    border: 3px solid #fff;
}

#dj-current {
    background: var(--unicorn-active);
    border-color: #fff;
    box-shadow: 0 0 20px var(--unicorn-active);
}

#dj-line {
    background: linear-gradient(90deg, rgba(255, 255, 255, 0.4), var(--unicorn-active));
}

/* Mute/Solo buttons */
.track-ctrls button {
    border-radius: 8px;
    border: 1px solid var(--unicorn-border);
    background: #fff;
    color: var(--unicorn-text);
    margin-bottom: 2px;
}

.track-ctrls button.active.mute-btn {
    background: var(--pastel-pink) !important;
    color: #c2185b !important;
    border-color: #c2185b !important;
}

.track-ctrls button.active.solo-btn {
    background: var(--pastel-blue) !important;
    color: #0288d1 !important;
    border-color: #0288d1 !important;
}

/* Global border color fallback */
* {
    border-color: var(--unicorn-border);
}

/* Popup Menu */
.popup-menu {
    position: absolute;
    background: rgba(0, 0, 0, 0.9);
    border: 1px solid #444;
    border-radius: 4px;
    padding: 5px 0;
    z-index: 1000;
    min-width: 100px;
}

.popup-menu.hidden {
    display: none;
}

.popup-menu .menu-item {
    padding: 8px 16px;
    color: #fff;
    cursor: pointer;
    font-size: 14px;
}

@media (hover: hover) {
    .popup-menu .menu-item:hover {
        background: #444;
    }
}

/* =====================================================================
   RESPONSIVE
   ===================================================================== */

#rotate-prompt {
    display: none !important;
}

@media (max-width: 932px) and (orientation: landscape) {
    body {
        overflow: hidden !important;
    }

    #sequencer-container {
        padding: 4px 20px 0 !important;
        height: 100vh !important;
        overflow: hidden !important;
        display: flex !important;
        flex-direction: column !important;
        justify-content: flex-start !important;
        gap: 4px !important;
    }

    #sequencer-inner {
        padding: 2px !important;
        margin-bottom: 0 !important;
        flex-shrink: 1 !important;
        display: flex !important;
        flex-direction: column !important;
    }

    #pattern-bank {
        height: 24px !important;
        min-height: 24px !important;
        margin-bottom: 2px !important;
    }

    .pattern-pad {
        font-size: 10px !important;
        height: 24px !important;
    }

    #sequencer-main {
        gap: 4px !important;
        align-items: flex-start !important;
    }

    #track-icons {
        display: flex !important;
        flex-direction: column !important;
        gap: 2px !important;
    }

    .track-item {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        height: 44px !important;
        margin-bottom: 0 !important;
        box-sizing: border-box !important;
    }

    .track-icon {
        width: 36px !important;
        height: 44px !important;
        font-size: 11px !important;
        border: 2px solid #b39ddb !important;
        box-sizing: border-box !important;
        margin: 0 !important;
    }

    .track-ctrls {
        display: flex !important;
        flex-direction: column !important;
        gap: 0 !important;
        justify-content: space-between !important;
        height: 44px !important;
        margin-left: 2px !important;
    }

    .track-ctrls button {
        width: 24px !important;
        height: 21px !important;
        font-size: 8px !important;
        margin: 0 !important;
    }

    .cell {
        width: 32px !important;
        height: 44px !important;
        box-sizing: border-box !important;
    }

    .cell-visual {
        border-radius: 4px !important;
    }

    #grid-container {
        grid-template-rows: repeat(5, 44px) !important;
        grid-template-columns: repeat(16, auto) !important;
        column-gap: 2px !important;
        row-gap: 2px !important;
    }

    .cell[data-step="3"],
    .cell[data-step="7"],
    .cell[data-step="11"] {
        margin-right: 4px !important;
    }

    #chain-container {
        min-height: 28px !important;
        height: 28px !important;
        padding-top: 0 !important;
        margin-top: 0 !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        z-index: 10 !important;
    }

    .chain-slot {
        width: 24px !important;
        height: 24px !important;
        min-width: 24px !important;
        min-height: 24px !important;
        font-size: 10px !important;
        border-width: 1px !important;
    }

    #chain-mode-switch {
        height: 24px !important;
        width: 24px !important;
    }

    .mode-option {
        font-size: 6px !important;
    }

    #controls {
        min-height: 55px !important;
        height: 55px !important;
        padding: 0 10px 0 !important;
        padding-bottom: env(safe-area-inset-bottom, 0) !important;
        gap: 8px !important;
        background: var(--pastel-green) !important;
        position: fixed !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        z-index: 100 !important;
    }

    .control-group {
        gap: 4px !important;
    }

    .control-btn {
        width: 36px !important;
        height: 36px !important;
        font-size: 10px !important;
        border-width: 2px !important;
    }

    .control-btn-sm {
        width: 36px !important;
        height: 17px !important;
        font-size: 8px !important;
        border-width: 1px !important;
    }

    #bpm-ctrl,
    #volume-ctrl {
        transform: scale(0.75);
    }

    #visualizer-display {
        width: 36px !important;
        height: 36px !important;
        background-size: 288px 36px !important;
        border-width: 2px !important;
        margin: 0 !important;
    }

    #file-btn {
        width: 36px !important;
        height: 36px !important;
        font-size: 10px !important;
    }

    #credit-btn {
        width: 32px !important;
        height: 32px !important;
        font-size: 16px !important;
        top: 8px !important;
        left: 8px !important;
    }
}

@media (orientation: portrait) {
    body {
        overflow: hidden !important;
    }

    #sequencer-container {
        padding: 42px 2px 70px !important;
        width: 100vw !important;
        overflow: hidden !important;
        align-items: stretch !important;
        box-sizing: border-box !important;
    }

    #sequencer-inner {
        padding: 2px !important;
        border-width: 2px !important;
        width: 100% !important;
        box-sizing: border-box !important;
        overflow: hidden !important;
    }

    #sequencer-main {
        flex-direction: row !important;
        gap: 1px !important;
        width: 100% !important;
        justify-content: flex-start !important;
    }

    #track-icons {
        width: 26px !important;
        min-width: 26px !important;
        flex-shrink: 0 !important;
    }

    .track-item {
        flex-direction: column !important;
        height: 80px !important;
        margin-bottom: 4px !important;
        gap: 2px !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
    }

    .track-icon {
        width: 26px !important;
        height: 60px !important;
        font-size: 10px !important;
        border-radius: 4px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    .track-ctrls {
        flex-direction: row !important;
        width: 26px !important;
    }

    .track-ctrls button {
        width: 13px !important;
        height: 14px !important;
        font-size: 7px !important;
        padding: 0 !important;
        line-height: 14px !important;
    }

    #grid-wrapper {
        flex: 1 !important;
        min-width: 0 !important;
        overflow: hidden !important;
    }

    #grid-container {
        grid-template-rows: repeat(5, 80px) !important;
        width: 100% !important;
        display: grid !important;
        grid-template-columns: repeat(16, 1fr) !important;
        column-gap: 0px !important;
        row-gap: 4px !important;
        box-sizing: border-box !important;
    }

    .cell {
        width: auto !important;
        height: 80px !important;
        min-width: 0 !important;
        box-sizing: border-box !important;
    }

    .cell-visual {
        border-radius: 4px !important;
    }

    .cell[data-step="3"],
    .cell[data-step="7"],
    .cell[data-step="11"] {
        margin-right: 0px !important;
    }

    #pattern-bank {
        height: 30px !important;
    }

    #chain-container {
        display: flex !important;
        height: auto !important;
        padding: 4px 0 !important;
        margin: 4px 0 !important;
        flex-wrap: nowrap !important;
        justify-content: center !important;
        align-items: center !important;
        gap: 2px !important;
        overflow: visible !important;
    }

    .chain-slot {
        flex: none !important;
        width: 32px !important;
        height: 32px !important;
        min-width: 32px !important;
        max-width: 32px !important;
        min-height: 32px !important;
        max-height: 32px !important;
        font-size: 11px !important;
        border-radius: 50% !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        padding: 0 !important;
        box-sizing: border-box !important;
        line-height: 1 !important;
        overflow: hidden !important;
    }

    #chain-mode-switch {
        flex: none !important;
        width: 32px !important;
        height: 32px !important;
        min-width: 32px !important;
        max-width: 32px !important;
        min-height: 32px !important;
        max-height: 32px !important;
        border-radius: 50% !important;
        padding: 0 !important;
        box-sizing: border-box !important;
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
        overflow: visible !important;
    }

    .mode-option {
        font-size: 5px !important;
    }

    .chain-arrow {
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        font-size: 8px !important;
        color: var(--unicorn-border) !important;
        opacity: 0.6 !important;
        width: 2px !important;
        height: 32px !important;
        margin: 0 !important;
    }

    #chain-container.mode-live .chain-arrow {
        display: none !important;
    }

    #controls {
        display: flex !important;
        flex-wrap: wrap !important;
        justify-content: center !important;
        align-items: center !important;
        padding: 4px 16px calc(env(safe-area-inset-bottom) + 4px) !important;
        height: auto !important;
        min-height: unset !important;
        gap: 4px 6px !important;
    }

    .control-group {
        display: flex !important;
        gap: 3px !important;
        align-items: center !important;
        order: 1 !important;
    }

    .control-btn {
        width: 34px !important;
        height: 34px !important;
        font-size: 10px !important;
    }

    .control-stack {
        gap: 1px !important;
    }

    .control-btn-sm {
        width: 36px !important;
        height: 17px !important;
        font-size: 8px !important;
    }

    #visualizer-display {
        width: 34px !important;
        height: 34px !important;
        background-size: 272px 34px !important;
        display: block !important;
        order: 2 !important;
    }

    #controls::before {
        content: "" !important;
        flex-basis: 100% !important;
        height: 0 !important;
        order: 3 !important;
    }

    #bpm-ctrl {
        transform: none !important;
        order: 4 !important;
    }

    #bpm-buttons {
        display: none !important;
    }

    #bpm-drag-value {
        font-size: 14px !important;
    }

    #volume-ctrl {
        display: flex !important;
        align-items: center !important;
        gap: 4px !important;
        transform: none !important;
        order: 5 !important;
    }

    #volume-ctrl .ctrl-label {
        font-size: 10px !important;
    }

    #volume-slider {
        width: 90px !important;
    }

    #file-btn {
        order: 6 !important;
    }

    #tone-panel {
        width: 90% !important;
        max-width: 320px !important;
        padding: 10px !important;
    }

    .knob {
        zoom: 0.7;
    }

    @media (min-width: 768px) {
        #sequencer-container {
            padding: 50px 12px 90px !important;
        }

        #sequencer-inner {
            padding: 6px !important;
            border-width: 3px !important;
        }

        #track-icons {
            width: 48px !important;
            min-width: 48px !important;
        }

        .track-item {
            height: 120px !important;
            gap: 3px !important;
        }

        .track-icon {
            width: 48px !important;
            height: 90px !important;
            font-size: 14px !important;
            border-radius: 6px !important;
        }

        .track-ctrls {
            width: 48px !important;
        }

        .track-ctrls button {
            width: 20px !important;
            height: 20px !important;
            font-size: 10px !important;
            line-height: 20px !important;
        }

        #grid-container {
            grid-template-rows: repeat(5, 120px) !important;
            column-gap: 2px !important;
            row-gap: 6px !important;
        }

        .cell {
            height: 120px !important;
            border-width: 2px !important;
        }

        .cell-visual {
            border-radius: 6px !important;
        }

        #pattern-bank {
            height: 40px !important;
        }

        .chain-slot {
            width: 42px !important;
            height: 42px !important;
            min-width: 42px !important;
            font-size: 14px !important;
        }

        #chain-mode-switch {
            width: 42px !important;
            height: 42px !important;
            min-width: 42px !important;
        }

        .mode-option {
            font-size: 8px !important;
        }

        #controls {
            flex-wrap: nowrap !important;
            padding: 8px 20px calc(env(safe-area-inset-bottom) + 8px) !important;
            gap: 12px !important;
            min-height: 60px !important;
        }

        #controls::before {
            display: none !important;
        }

        .control-group {
            order: 0 !important;
        }

        .control-btn {
            width: 60px !important;
            height: 60px !important;
            font-size: 14px !important;
        }

        .control-btn-sm {
            width: 60px !important;
            height: 28px !important;
            font-size: 11px !important;
        }

        #visualizer-display {
            width: 60px !important;
            height: 60px !important;
            background-size: 480px 60px !important;
            order: 0 !important;
        }

        #bpm-ctrl {
            order: 0 !important;
            transform: none !important;
        }

        #bpm-buttons {
            display: flex !important;
        }

        #volume-ctrl {
            order: 0 !important;
            gap: 6px !important;
        }

        #volume-ctrl .ctrl-label {
            font-size: 12px !important;
        }

        #volume-slider {
            width: 120px !important;
        }

        #file-btn {
            order: 0 !important;
        }

        #tone-panel {
            max-width: 500px !important;
            padding: 16px !important;
        }

        .knob {
            zoom: 0.9;
        }
    }
}