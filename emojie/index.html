<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>DESU™ emojie</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="/desu/favicon.js"></script>
</head>

<body>
    <!-- キャンバスエリア (Flex Item 1) -->
    <div id="canvas-area">
        <div id="canvas-container">
            <canvas id="canvas"></canvas>
        </div>

        <!-- 左側ツールバー (描画系・履歴) -->
        <div id="toolbar-left">
            <!-- ツール切り替え -->
            <div class="tool-group">
                <div class="tool-btn segment-btn active" data-mode="draw">
                    <span class="emoji-icon">😀</span>
                    <div class="tool-tooltip tool-tooltip-right">描画モード</div>
                </div>
                <div class="tool-btn segment-btn" data-mode="select">
                    <span class="emoji-icon">👆</span>
                    <div class="tool-tooltip tool-tooltip-right">選択モード</div>
                </div>
            </div>

            <div class="divider-h"></div>

            <!-- Undo/Redo -->
            <div class="tool-group">
                <button id="undo-btn" class="tool-btn history-btn disabled">
                    <span class="emoji-icon">↩️</span>
                    <div class="tool-tooltip tool-tooltip-right">元に戻す</div>
                </button>
                <button id="redo-btn" class="tool-btn history-btn disabled">
                    <span class="emoji-icon">↪️</span>
                    <div class="tool-tooltip tool-tooltip-right">やり直し</div>
                </button>
            </div>
        </div>

        <!-- 右上ツールバー (キャンバスエリア内に配置) -->
        <div id="toolbar-right">
            <div class="tool-btn" id="bgToggleBtn">
                <span class="emoji-icon">🖼️</span>
                <div class="tool-tooltip tool-tooltip-bottom">背景色</div>
                <input type="color" id="bgColorPicker" value="#ffffff"
                    style="position:absolute; opacity:0; width:100%; height:100%; top:0; left:0; cursor:pointer;">
            </div>
            <div class="tool-btn" id="saveBtn">
                <span class="emoji-icon">📥</span>
                <div class="tool-tooltip tool-tooltip-bottom tooltip-offset-2">保存</div>
            </div>
            <div class="tool-btn" id="clearBtn">
                <span class="emoji-icon">💣</span>
                <div class="tool-tooltip tool-tooltip-bottom tooltip-offset-3">全消去</div>
            </div>
        </div>
    </div>

    <!-- 編集パネル (Flex Item 2) -->
    <div id="edit-panel">
        <div class="panel-row top-row">

            <div class="preview-container">
                <div id="emoji-preview">😀</div>
            </div>

            <div class="center-controls">
                <div class="controls-container">
                    <div class="control-group">
                        <label>📏</label>
                        <input type="range" id="size-slider" min="20" max="800" value="60" step="1">
                        <span id="size-value">60px</span>
                    </div>

                    <div class="control-group">
                        <label>🔄</label>
                        <input type="range" id="rotation-slider" min="0" max="360" value="0" step="1">
                        <span id="rotation-value">0°</span>
                    </div>
                </div>

                <button id="flip-h" class="edit-btn icon-btn" title="左右反転">↔️</button>
            </div>

            <!-- アクション (右側へ集約) -->
            <div class="actions-container">
                <div id="layer-controls" class="button-grid">
                    <div class="button-row">
                        <button id="bring-front" class="edit-btn icon-btn" title="最前面">🔝</button>
                        <button id="bring-forward" class="edit-btn icon-btn" title="前面">🔼</button>
                    </div>
                    <div class="button-row">
                        <button id="send-back" class="edit-btn icon-btn" title="最背面">🔚</button>
                        <button id="send-backward" class="edit-btn icon-btn" title="背面">🔽</button>
                    </div>
                </div>
                <button id="delete-emoji" class="edit-btn delete-btn icon-btn" title="削除">🗑️</button>
            </div>
        </div>
    </div>

    <!-- 絵文字ピッカーエリア (Flex Item 3) -->
    <div id="emoji-picker-container">
        <div id="emoji-search-bar">
            <input type="text" id="emoji-search" placeholder="🔍">
        </div>



        <!-- カテゴリタブ -->
        <div id="emoji-categories">
            <!-- Dynamic tabs will be inserted here -->
        </div>

        <!-- 絵文字リスト -->
        <div id="emoji-list-container">
            <div id="emoji-list" class="emoji-list"></div>
        </div>
    </div>

    <!-- 保存UI -->
    <div id="save-overlay"></div>
    <div id="save-ui">
        <h3>範囲をドラッグして選択</h3>
        <div id="selection-size" style="display:none; font-size: 13px; color: #666; margin-bottom: 8px;"></div>

        <div class="option-group">
            <div class="option-group-label">倍率</div>
            <div class="option-buttons">
                <button class="option-btn active" data-scale="1">1x</button>
                <button class="option-btn" data-scale="2">2x</button>
                <button class="option-btn" data-scale="3">3x</button>
            </div>
        </div>

        <label>
            <input type="checkbox" id="transparentBg" checked>
            背景透過
        </label>

        <div>
            <button class="save-btn" id="saveAllBtn">全体を保存</button>
            <button class="save-btn primary" id="confirmSelectionBtn" style="display:none;">確定</button>
            <button class="save-btn" id="copyClipboardBtn" style="display:none;">コピー</button>
            <button class="save-btn" id="redoSelectionBtn" style="display:none;">やり直し</button>
            <button class="save-btn" id="cancelSaveBtn">閉じる</button>
        </div>
    </div>

    <canvas id="selection-canvas"></canvas>

    <!-- クレジットボタンとモーダル -->
    <div id="credit-btn">?</div>
    <div id="credit-modal">
        <div id="credit-content">
            <h2>DESU™ emojie</h2>
            <a href="https://warpshoot.github.io/desu/" target="_blank" id="credit-logo">
                <img src="../images/logo.gif" alt="DESU™ emojie">
            </a>
            <div id="credit-author">
                by <a href="https://warpshoot.github.io/" target="_blank">wpy</a>
            </div>
        </div>
    </div>

    <script src="js/data/emojis.js"></script>
    <script type="module" src="js/app.js"></script>
</body>

</html>